# 密钥恢复说明模板

**⚠️ 重要：此文档包含密钥恢复步骤，请安全保存。建议打印多份，存储在安全位置。**

---

## 基本信息

- **密钥类型**：_________________（如：32-byte hex私钥 / BIP39助记词等）
- **分片生成日期**：_________________
- **分片工具版本**：Python sss_tool.py v1.0
- **恢复要求**：需要任意2个分片即可恢复

---

## 分片存储位置

请在下方记录每个分片的存储位置（建议使用密码或提示，而非明文）：

### 分片1（x=1）
- **主存储位置**：_________________
- **备用位置**：_________________
- **访问方式**：_________________
- **备注**：_________________

### 分片2（x=2）
- **主存储位置**：_________________
- **备用位置**：_________________
- **访问方式**：_________________
- **备注**：_________________

### 分片3（x=3）
- **主存储位置**：_________________
- **备用位置**：_________________
- **访问方式**：_________________
- **备注**：_________________

---

## 恢复步骤（详细）

### 前置准备

1. **获取恢复工具**
   - 需要：`src/sss_tool.py` Python脚本（或整个项目目录）
   - Python版本：Python 3.6 或更高
   - 获取方式：_________________（如：GitHub仓库、备份USB等）

2. **收集分片**
   - 需要任意2个分片（格式：`x:base64_string`）
   - 示例格式：
     ```
     1:AbCdEf123456==
     2:XyZaBc789012==
     ```

### 方法1：命令行恢复（推荐）

#### 步骤1：安装Python（如未安装）

**macOS / Linux**:
```bash
# 检查是否已安装
python3 --version

# 如果未安装，使用系统包管理器
# macOS: brew install python3
# Ubuntu/Debian: sudo apt install python3
```

**Windows**:
- 访问 https://www.python.org/downloads/
- 下载并安装Python 3.6+

#### 步骤2：准备恢复脚本

```bash
# 下载或复制整个项目目录到本地
# 进入项目目录
cd shamir-secret-sharing

# 确保脚本有执行权限（Linux/macOS，可选）
chmod +x src/sss_tool.py
```

#### 步骤3：执行恢复

```bash
# 基本用法（输出hex格式）
python3 src/sss_tool.py combine "1:你的分片1内容" "2:你的分片2内容"

# 如果分片存储在文件中
python3 src/sss_tool.py combine "$(cat share1.txt)" "$(cat share2.txt)"

# 输出到文件
python3 src/sss_tool.py combine "1:..." "2:..." --output recovered_secret.txt
```

#### 步骤4：验证恢复结果

- 检查输出长度是否符合预期
- 如果原始密钥是已知的，比对是否一致
- **注意**：恢复后的密钥应妥善保管，避免再次丢失

---

### 方法2：使用ssss工具（备选）

如果Python脚本不可用，可以使用标准`ssss`工具：

#### 安装ssss

**macOS**:
```bash
brew install ssss
```

**Linux**:
```bash
sudo apt-get install ssss  # Debian/Ubuntu
# 或
sudo yum install ssss      # CentOS/RHEL
```

#### 恢复步骤

```bash
# 1. 将base64分片转换为hex（需要额外脚本）
# 2. 使用ssss-combine
ssss-combine -t 2 -x
# 然后输入2个分片的x坐标和值（hex格式）
```

**注意**：`ssss`工具使用不同的格式，需要转换。建议优先使用本方案的Python脚本。

---

## 常见问题排查

### 问题1：提示"Invalid share format"

**原因**：分片格式错误

**解决**：
- 检查分片是否为 `x:base64_string` 格式
- 确保没有多余的空白字符
- 确保base64字符串完整（可能被截断）

### 问题2：提示"Need at least 2 shares"

**原因**：只提供了1个分片

**解决**：需要提供2个或更多分片

### 问题3：恢复的密钥不正确

**可能原因**：
1. 分片被损坏或修改
2. 使用了错误的分片
3. 分片顺序错误（顺序不影响，但x坐标必须正确）

**解决**：
- 尝试使用其他2个分片组合（如分片1+分片3，或分片2+分片3）
- 检查分片文件完整性（是否有损坏）
- 确认分片来自正确的密钥

### 问题4：Python脚本无法运行

**可能原因**：
- Python版本过低（需要3.6+）
- 缺少标准库模块

**解决**：
```bash
# 检查Python版本
python3 --version

# 尝试使用python而不是python3
python src/sss_tool.py combine ...
```

---

## 紧急恢复联系

如果在恢复过程中遇到困难：

1. **技术支持**：_________________（联系方式）
2. **备用恢复方法**：_________________
3. **物理备份位置**：_________________（如保险箱）

---

## 安全提醒

⚠️ **恢复密钥后**：
- 立即将密钥转移到安全位置（如硬件钱包）
- 不要将密钥存储在未加密的设备上
- 考虑重新生成分片（如果怀疑分片已泄露）

⚠️ **此文档应**：
- 与分片分开存储
- 使用密码保护（如PDF加密）
- 定期更新（如存储位置变更）

---

## 示例：完整恢复流程

假设您有以下2个分片：

```
分片1: 1:dGVzdCBzZWNyZXQgd2l0aCBzb21lIGRhdGE=
分片2: 2:YW5vdGhlciBzaGFyZSB3aXRoIG1vcmUgZGF0YQ==
```

**恢复命令**：
```bash
python3 src/sss_tool.py combine \
  "1:dGVzdCBzZWNyZXQgd2l0aCBzb21lIGRhdGE=" \
  "2:YW5vdGhlciBzaGFyZSB3aXRoIG1vcmUgZGF0YQ=="
```

**输出**：
```
✓ 恢复的秘密:
0x1234567890abcdef...
```

---

**文档创建日期**：_________________
**最后更新日期**：_________________
**创建人签名**：_________________

---

*此模板应在生成分片时填写并安全保存。建议打印多份，分别存储。*

